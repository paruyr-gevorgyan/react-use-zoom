{"version":3,"file":"index.module.js","sources":["../src/matrix.js","../src/velocity.js","../src/index.js"],"sourcesContent":["export default class Matrix {\n  constructor(svg) {\n    this.svg = svg || document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n\n    this.vtm = this.createSVGMatrix();\n\n    this.x = 0;\n    this.y = 0;\n  }\n\n  clamp(scale, in_x, in_y, ratio) {\n    let xx = (window.innerWidth - ratio.width) / 2;\n    let yy = (window.innerHeight - ratio.height) / 2;\n\n    let limit_max_right_formula = xx * scale + ratio.width * scale - window.innerWidth;\n\n    let same_x = Math.min(this.vtm.e * 1.0, 0);\n    let same_y = Math.min(this.vtm.f * 1.0, 0);\n\n    let value1 = in_x > 0 ? same_x : -(xx * scale);\n    let value2 = in_x > 0 ? same_x : -limit_max_right_formula;\n\n    let limit_x_axis = this.vtm.e;\n    limit_x_axis = Math.max(value2, this.vtm.e);\n    limit_x_axis = Math.min(value1, limit_x_axis);\n\n    let limit_max_bottom_formula = yy * scale + ratio.height * scale - window.innerHeight;\n    let limit_max_top = in_y > 0 ? same_y : -(yy * scale);\n    let limit_max_bottom = in_y > 0 ? same_y : -limit_max_bottom_formula;\n\n    let limit_y_axis = this.vtm.f;\n    limit_y_axis = Math.min(limit_max_top, limit_y_axis);\n    limit_y_axis = Math.max(limit_y_axis, limit_max_bottom);\n\n    this.vtm = this.createSVGMatrix()\n      .translate(limit_x_axis, limit_y_axis)\n      .scale(Math.max(this.vtm.a, 1));\n  }\n\n  createSVGMatrix() {\n    return this.svg.createSVGMatrix();\n  }\n\n  move(x, y, in_x, in_y, ratio) {\n    this.vtm = this.createSVGMatrix()\n      .translate(this.x - x, this.y - y)\n      .scale(this.vtm.a);\n\n    this.clamp(this.vtm.a, in_x, in_y, ratio);\n    return this.vtm;\n  }\n\n  scale(xFactor, yFactor, origin, in_x, in_y, ratio) {\n    this.vtm = this.createSVGMatrix()\n      .translate(origin.x, origin.y)\n      .scale(xFactor, yFactor)\n      .translate(-origin.x, -origin.y)\n      .multiply(this.vtm);\n\n    let pre_scale = Math.max(this.vtm.a, 1);\n\n    this.clamp(pre_scale, in_x, in_y, ratio);\n\n    return this.vtm;\n  }\n}\n","export default class MultiTouchVelocity {\n  constructor() {\n    this.touchA = {\n      clientX: 0,\n      clientY: 0,\n      t: 0,\n    };\n    this.touchB = {\n      clientX: 0,\n      clientY: 0,\n      t: 0,\n    };\n  }\n  down(touchA, touchB) {\n    this.touchA = { clientX: touchA.clientX, clientY: touchA.clientY, t: Date.now(), velocity: 0 };\n    this.touchB = { clientX: touchB.clientX, clientY: touchB.clientY, t: Date.now(), veloctiy: 0 };\n  }\n  calc(touch, ins) {\n    var new_x = touch.clientX,\n      new_y = touch.clientY,\n      new_t = Date.now();\n\n    var x_dist = new_x - ins.clientX,\n      y_dist = new_y - ins.clientY,\n      interval = new_t - ins.t;\n    var velocity = Math.sqrt(x_dist * x_dist + y_dist * y_dist) / interval;\n    ins.velocity = velocity;\n    // update values:\n    ins.clientX = new_x;\n    ins.clientY = new_y;\n    ins.t = new_t;\n  }\n  getVelocity(touchA, touchB) {\n    this.calc(touchA, this.touchA);\n    this.calc(touchB, this.touchB);\n    return this.touchA.velocity + this.touchB.velocity;\n  }\n}\n","import { useRef, useEffect, useState } from \"react\";\n\nfunction calculateAspectRatioFit(srcWidth, srcHeight, maxWidth, maxHeight) {\n  var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);\n\n  return { width: srcWidth * ratio, height: srcHeight * ratio, ratio };\n}\n\nconst getDistance = (touchA, touchB) => {\n  return Math.hypot(touchA.pageX - touchB.pageX, touchA.pageY - touchB.pageY);\n};\n\nimport Matrix from \"./matrix\";\nimport MultiTouchVelocity from \"./velocity\";\n\nfunction useZoom() {\n  const xY = useRef({\n    initX: 0,\n    initY: 0,\n    newX: 0,\n    newY: 0,\n  });\n  const ratio = useRef();\n  const oldScale = useRef();\n  const img = useRef();\n  const matrix = useRef(new Matrix());\n\n  const _velocity = useRef(new MultiTouchVelocity());\n\n  const lastTap = useRef({\n    time: 0,\n    x: 0,\n    run: false,\n  });\n\n  const scale = useRef({\n    scaling: false,\n    x1: 0,\n    x2: 0,\n    y1: 0,\n    y2: 0,\n\n    lastHypo: 0,\n\n    originX: 0,\n    originY: 0,\n    value: 1,\n    max: 1,\n  });\n\n  const [fit, setFit] = useState(false);\n\n  const onWheel = e => {\n    e.preventDefault();\n    const dir = e.deltaY < 0 ? 1 : -1;\n\n    const xFactor = 1 + 0.1 * dir;\n    const yFactor = (xFactor * window.innerHeight) / window.innerWidth;\n\n    if (scale.current.value * xFactor >= scale.current.max) return;\n\n    let in_x = (window.innerWidth - ratio.current.width * matrix.current.vtm.a) / 2; // maybe need to pre scale\n    let in_y = (window.innerHeight - ratio.current.height * matrix.current.vtm.a) / 2;\n\n    const origin = {\n      x: in_x > 0 ? window.innerWidth / 2 : e.pageX,\n      y: in_y > 0 ? window.innerHeight / 2 : e.pageY,\n    };\n\n    const mat = matrix.current.scale(xFactor, yFactor, origin, in_x, in_y, ratio.current);\n    img.current.style.transform = `translate(${mat.e}px,${mat.f}px) scale(${mat.d})`;\n    scale.current.value = mat.d;\n  };\n\n  useEffect(() => {\n    window.addEventListener(\"wheel\", onWheel, { passive: false }); //asd\n  }, []);\n\n  const onMouseDown = ({ clientX, clientY }) => {\n    fireDown(clientX, clientY);\n\n    window.addEventListener(\"mousemove\", onMouseMove);\n    window.addEventListener(\"mouseup\", onMouseUp);\n  };\n\n  const onMouseMove = ({ clientX, clientY }) => {\n    fireMove(clientX, clientY);\n  };\n\n  const onMouseUp = () => {\n    window.removeEventListener(\"mousemove\", onMouseMove);\n    fireUp();\n  };\n\n  const fireDown = (x, y) => {\n    xY.current.initX = x;\n    xY.current.initY = y;\n\n    matrix.current.x = matrix.current.vtm.e;\n    matrix.current.y = matrix.current.vtm.f;\n  };\n\n  const fireMove = (x, y) => {\n    if (scale.current.scaling) return;\n    let in_x = (window.innerWidth - ratio.current.width * matrix.current.vtm.a) / 2;\n    let in_y = (window.innerHeight - ratio.current.height * matrix.current.vtm.a) / 2;\n\n    xY.current.newX = xY.current.initX - x;\n    xY.current.newY = xY.current.initY - y;\n    const mat = matrix.current.move(in_x >= 0 ? 0 : xY.current.newX, in_y >= 0 ? 0 : xY.current.newY, in_x, in_y, ratio.current);\n\n    img.current.style.transform = `matrix(${mat.a},${mat.b},${mat.c},${mat.d},${mat.e}, ${mat.f})`;\n  };\n\n  const fireUp = () => {\n    matrix.current.x -= xY.current.newX;\n    matrix.current.y -= xY.current.newY;\n\n    scale.current.scaling = false;\n    oldScale.current = matrix.current.vtm.d;\n    scale.current.lastHypo = 0;\n  };\n\n  const fireScale = (touchA, touchB) => {\n    oldScale.current = matrix.current.vtm.a;\n    const xTouch = [Math.min(touchA.pageX, touchB.pageX), Math.max(touchA.pageX, touchB.pageX)];\n\n    const yTouch = [Math.min(touchA.pageY, touchB.pageY), Math.max(touchA.pageY, touchB.pageY)];\n    //df\n    const W = xTouch[1] - xTouch[0];\n    const centerX = W / 2 + xTouch[0];\n\n    const H = yTouch[1] - yTouch[0];\n    const centerY = H / 2 + yTouch[0];\n\n    scale.current.originX = centerX;\n    scale.current.originY = centerY;\n    scale.current.lastHypo = Math.trunc(getDistance(touchA, touchB));\n  };\n\n  const fireTapScale = (x, y) => {\n    let scaleVtm = matrix.current.vtm.a;\n    let scale_value = scaleVtm > 1 ? scaleVtm - 1 : 0.5;\n    let scale_factor = scaleVtm > 1 ? -1 : 1;\n\n    const xFactor = 1 + scale_value * scale_factor;\n    const yFactor = (xFactor * window.innerHeight) / window.innerWidth;\n\n    if (scale.current.value * xFactor >= scale.current.max) return;\n\n    let in_x = (window.innerWidth - ratio.current.width * Math.max(xFactor * scaleVtm, 1)) / 2; // maybe vtm.a * xFactor\n    let in_y = (window.innerHeight - ratio.current.height * Math.max(xFactor * scaleVtm, 1)) / 2; // maybe vtm.a * yFactor\n\n    const origin = {\n      x: in_x > 0 ? window.innerWidth / 2 : x,\n      y: in_y > 0 ? window.innerHeight / 2 : y,\n    };\n\n    const mat = matrix.current.scale(xFactor, yFactor, origin, in_x, in_y, ratio.current);\n\n    scale.current.value = mat.d;\n    img.current.style.transform = `translate(${mat.e}px, ${mat.f}px) scale(${mat.d})`;\n  };\n\n  const onTouchStart = e => {\n    const isMultiTouch = e.touches.length === 2;\n    const [touchA, touchB] = e.touches;\n\n    scale.current.scaling = isMultiTouch;\n\n    img.current.classList.remove(\"tr\");\n    if (isMultiTouch) {\n      fireScale(touchA, touchB);\n\n      _velocity.current.down(touchA, touchB);\n    } else {\n      // === start ===\n      var now = new Date().getTime();\n      if (now - lastTap.current.time < 250 && Math.abs(lastTap.current.x - touchA.pageX) <= 20) {\n        img.current.classList.add(\"tr\");\n        fireTapScale(touchA.pageX, touchA.pageY);\n      }\n\n      lastTap.current.time = new Date().getTime();\n      lastTap.current.x = touchA.pageX;\n\n      fireDown(touchA.pageX, touchA.pageY);\n    }\n\n    // Clean up\n    window.removeEventListener(\"touchmove\", onTouchMove);\n    window.removeEventListener(\"touchend\", onTouchEnd);\n    //--\n    window.addEventListener(\"touchmove\", onTouchMove);\n    window.addEventListener(\"touchend\", onTouchEnd);\n  };\n\n  const fireScaleMove = (touchA, touchB, e) => {\n    const hypo = getDistance(touchA, touchB);\n\n    let f = hypo / scale.current.lastHypo;\n\n    f = f >= 1 ? 1 : -1;\n\n    const ff = _velocity.current.getVelocity(touchA, touchB);\n\n    const xFactor = 1 + 0.1 * ff * f;\n\n    // If scale is too much.. than stop;\n    if (scale.current.value * xFactor >= scale.current.max) return;\n\n    const yFactor = (xFactor * window.innerHeight) / window.innerWidth;\n\n    let in_x = (window.innerWidth - ratio.current.width * matrix.current.vtm.a) / 2; // maybe * xFactor\n    let in_y = (window.innerHeight - ratio.current.height * matrix.current.vtm.a) / 2; // maybe * yFactor\n\n    const origin = {\n      x: in_x > 0 ? window.innerWidth / 2 : scale.current.originX,\n      y: in_y > 0 ? window.innerHeight / 2 : scale.current.originY,\n    };\n\n    const mat = matrix.current.scale(xFactor, yFactor, origin, in_x, in_y, ratio.current);\n\n    img.current.style.transform = `translate(${mat.e}px, ${mat.f}px) scale(${mat.d})`;\n\n    // max value\n    scale.current.value = mat.d;\n\n    scale.current.lastHypo = hypo;\n    scale.current.scaling = true;\n  };\n  const onTouchMove = e => {\n    if (scale.current.scaling) {\n      const [touchA, touchB] = e.touches;\n      fireScaleMove(touchA, touchB);\n    } else {\n      fireMove(e.touches[0].pageX, e.touches[0].pageY);\n    }\n  };\n\n  const onTouchEnd = e => {\n    fireUp();\n    window.removeEventListener(\"touchmove\", onTouchMove);\n    window.removeEventListener(\"touchend\", onTouchEnd);\n    window.removeEventListener(\"touchcancel\", onTouchEnd);\n  };\n\n  const onLoad = () => {\n    const { naturalWidth, naturalHeight } = img.current;\n\n    if (naturalWidth > window.innerWidth || naturalHeight > window.innerHeight) {\n      setFit(true);\n    }\n\n    scale.current.max = Math.max(naturalWidth / window.innerWidth, 1);\n    ratio.current = calculateAspectRatioFit(img.current.naturalWidth, img.current.naturalHeight, window.innerWidth, window.innerHeight);\n  };\n\n  return {\n    events: {\n      onLoad,\n      onTouchStart,\n      onMouseDown,\n    },\n    objectFit: fit,\n    imgRef: img,\n  };\n}\n\nexport default useZoom;\n"],"names":["Matrix","svg","this","document","createElementNS","vtm","createSVGMatrix","x","y","clamp","scale","in_x","in_y","ratio","xx","window","innerWidth","width","yy","innerHeight","height","limit_max_right_formula","same_x","Math","min","e","same_y","f","value1","limit_x_axis","max","limit_max_bottom_formula","limit_max_bottom","limit_y_axis","translate","a","move","xFactor","yFactor","origin","multiply","pre_scale","MultiTouchVelocity","touchA","clientX","clientY","t","touchB","down","Date","now","velocity","veloctiy","calc","touch","ins","new_x","new_y","new_t","x_dist","y_dist","interval","sqrt","getVelocity","getDistance","hypot","pageX","pageY","xY","useRef","initX","initY","newX","newY","oldScale","img","matrix","_velocity","lastTap","time","run","scaling","x1","x2","y1","y2","lastHypo","originX","originY","value","useState","fit","setFit","onWheel","preventDefault","deltaY","current","mat","style","transform","d","useEffect","addEventListener","passive","onMouseMove","fireMove","onMouseUp","removeEventListener","fireUp","fireDown","b","c","onTouchMove","touches","hypo","fireScaleMove","onTouchEnd","events","onLoad","naturalWidth","naturalHeight","srcWidth","srcHeight","maxWidth","maxHeight","calculateAspectRatioFit","onTouchStart","isMultiTouch","length","classList","remove","xTouch","yTouch","centerY","trunc","fireScale","getTime","abs","add","scaleVtm","fireTapScale","onMouseDown","objectFit","imgRef"],"mappings":"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"}